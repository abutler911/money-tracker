<h1><%= title %></h1>
<p>Welcome, <%= user.username %>!</p>

<div>
  <% if (accounts.length > 0) { %>
  <ul>
    <% accounts.forEach(account => { %>
    <li>
      <span><%= account.accountName %>:</span>
      <input type="number" name="amount" value="<%= account.amount %>" />
    </li>
    <% }); %>
  </ul>
  <button id="updateBtn">Update All Amounts</button>
  <% } else { %>
  <p>No accounts found.</p>
  <% } %>
</div>

<script>
  document.getElementById("updateBtn").addEventListener("click", function () {
    // Gather updated amounts
    const updatedAccounts = [];
    document.querySelectorAll('input[name="amount"]').forEach((input) => {
      updatedAccounts.push({
        name: input.previousSibling.textContent.trim(), // Get account name
        amount: input.value,
      });
    });

    console.log("Updated accounts:", updatedAccounts); // Log updatedAccounts for debugging

    // Send updated accounts data to the server
    fetch("/update-accounts", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(updatedAccounts), // Send the data as JSON string
    })
      .then((response) => {
        if (response.ok) {
          alert("Accounts updated successfully!");
        } else {
          throw new Error("Failed to update accounts");
        }
      })
      .catch((error) => {
        console.error("Error updating accounts:", error);
        alert("Failed to update accounts. Please try again later.");
      });
  });
</script>
